# NarrativeGen Web Tester - テスト手順ガイド

## 概要
このガイドは、NarrativeGen Web Testerアプリケーションの包括的なテスト手順を提供します。各テストケースには、実行手順と期待される結果が記載されています。

## テスト環境要件
- Node.js 20+
- npm 8+
- モダンなWebブラウザ (Chrome, Firefox, Safari, Edge)
- インターネット接続 (AI機能テスト時)

---

## 1. 環境セットアップテスト

### 1.1 プロジェクト初期化テスト
**実行手順:**
```bash
# プロジェクトルートで実行
npm install
npm run build:all
```

**期待結果:**
- ✅ npm install がエラーなく完了
- ✅ npm run build:all がエラーなく完了
- ✅ packages/engine-ts/dist/ にJavaScriptファイルが生成
- ✅ apps/web-tester/dist/ にHTML/CSS/JSファイルが生成

### 1.2 開発サーバー起動テスト
**実行手順:**
```bash
npm run dev:tester
```

**期待結果:**
- ✅ サーバーがポート5173で起動
- ✅ "Local: http://localhost:5173/" と表示
- ✅ "Network: http://0.0.0.0:5173/" と表示

---

## 2. 基本機能テスト

### 2.1 ページ読み込みテスト
**実行手順:**
1. ブラウザで http://localhost:5173 を開く
2. ページが完全に読み込まれるまで待つ

**期待結果:**
- ✅ ページタイトル: "NarrativeGen Web Tester"
- ✅ ヘッダーに "NarrativeGen Web Tester" と説明文
- ✅ 4つのタブ: ストーリー, ノードグラフ, デバッグ, AI支援
- ✅ コンソールにJavaScriptエラーがない
- ✅ ガラスモーフィズムUIが適用されている

### 2.2 サンプルモデル読み込みテスト
**実行手順:**
1. ページ読み込み後
2. "モデル選択" ドロップダウンから "linear" を選択
3. "開始" ボタンをクリック

**期待結果:**
- ✅ ステータスに "サンプル linear を実行中" と表示
- ✅ ストーリーテキストが表示される
- ✅ 選択肢ボタンが表示される
- ✅ 状態ビューにJSONデータが表示される

### 2.3 ストーリー進行テスト
**実行手順:**
1. サンプルモデルを読み込み
2. 表示された選択肢ボタンをクリック

**期待結果:**
- ✅ ストーリーが次のノードに進む
- ✅ 新しいテキストが追加される
- ✅ 選択肢が更新される
- ✅ 状態ビューが更新される

---

## 3. UI/UXテスト

### 3.1 タブ切り替えテスト
**実行手順:**
1. 各タブ (ストーリー, ノードグラフ, デバッグ, AI支援) をクリック

**期待結果:**
- ✅ アクティブなタブがハイライトされる
- ✅ 対応するパネルが表示される
- ✅ 他のパネルが非表示になる
- ✅ URLハッシュが変更される

### 3.2 レスポンシブデザインテスト
**実行手順:**
1. ブラウザウィンドウをさまざまなサイズに変更
2. モバイルサイズ (375px) でテスト

**期待結果:**
- ✅ レイアウトが適切に調整される
- ✅ テキストが読みやすいサイズを維持
- ✅ ボタンがタッチしやすいサイズ

### 3.3 キーボードショートカットテスト
**実行手順:**
1. ページ上で以下のキーを押す:
   - `s`: ストーリータブ
   - `g`: グラフタブ
   - `d`: デバッグタブ
   - `a`: AIタブ

**期待結果:**
- ✅ 対応するタブがアクティブになる
- ✅ タブ切り替えが機能する

---

## 4. AI機能テスト

### 4.1 AIプロバイダー初期化テスト
**実行手順:**
1. "AI支援" タブをクリック
2. "プロバイダー" ドロップダウンから "mock" を選択

**期待結果:**
- ✅ "mockプロバイダーが初期化されました" と表示
- ✅ エラーが発生しない

### 4.2 AIテキスト生成テスト
**実行手順:**
1. モデルを読み込み
2. AIタブで "次のノードを生成" ボタンをクリック

**期待結果:**
- ✅ 生成されたテキストが表示される
- ✅ 処理時間が表示される
- ✅ エラーが発生しない

### 4.3 AI言い換えテスト
**実行手順:**
1. モデルを読み込み
2. AIタブで "現在のテキストを言い換え" ボタンをクリック

**期待結果:**
- ✅ 3つの言い換え候補が表示される
- ✅ 処理時間が表示される
- ✅ エラーが発生しない

---

## 5. CSV統合テスト

### 5.1 CSVインポートテスト
**実行手順:**
1. "CSVインポート" ボタンをクリック
2. サンプルCSVファイルを選択 (例: models/spreadsheets/tutorial.csv)

**期待結果:**
- ✅ CSVプレビューモーダルが表示される
- ✅ テーブル形式でCSV内容が表示される
- ✅ "インポート" ボタンでモデルが読み込まれる

### 5.2 CSVエクスポートテスト
**実行手順:**
1. モデルを読み込み
2. "CSVエクスポート" ボタンをクリック

**期待結果:**
- ✅ CSVファイルがダウンロードされる
- ✅ ファイル名が適切 (model.csv)
- ✅ Excelなどで開くと正しいデータ構造

---

## 6. エラーハンドリングテスト

### 6.1 無効なモデル読み込みテスト
**実行手順:**
1. 無効なJSONファイルをアップロード

**期待結果:**
- ✅ エラーメッセージが表示される
- ✅ アプリケーションがクラッシュしない
- ✅ 以前の状態が維持される

### 6.2 ネットワークエラーテスト
**実行手順:**
1. インターネットを切断
2. AI機能を試行

**期待結果:**
- ✅ 適切なエラーメッセージが表示される
- ✅ アプリケーションがクラッシュしない

---

## 7. パフォーマンステスト

### 7.1 大規模モデル読み込みテスト
**実行手順:**
1. 大規模なモデルファイル (branching_flags.json) を読み込み

**期待結果:**
- ✅ 読み込み時間が妥当 (5秒以内)
- ✅ UIがフリーズしない
- ✅ メモリ使用量が適切

### 7.2 グラフ仮想化テスト
**実行手順:**
1. 大規模モデルを読み込み
2. "ノードグラフ" タブをクリック

**期待結果:**
- ✅ グラフが表示される
- ✅ ノード数が100を超える場合、仮想化される
- ✅ パフォーマンスが維持される

---

## 8. 統合テスト

### 8.1 エンドツーエンド物語作成テスト
**実行手順:**
1. 新しいモデルを作成
2. GUIエディタでノードと選択肢を追加
3. CSVにエクスポート
4. CSVを再インポート
5. 物語を最後までプレイ

**期待結果:**
- ✅ すべての機能が連携して動作
- ✅ データの整合性が維持される
- ✅ エラーが発生しない

### 8.2 データ永続性テスト
**実行手順:**
1. モデルを編集
2. ブラウザをリロード
3. 以前の状態が維持されているか確認

**期待結果:**
- ✅ モデルデータが維持される
- ✅ 設定が維持される
- ✅ セッション状態が適切にリセットされる

---

## トラブルシューティング

### 一般的な問題と解決法

#### インポートエラーが発生する場合
```bash
# エンジンを再ビルド
npm run build:engine

# 開発サーバーを再起動
npm run dev:tester
```

#### モデル読み込みエラーが発生する場合
- モデルJSONの構文を確認
- models/examples/ ディレクトリのファイルが存在するか確認

#### AI機能が動作しない場合
- インターネット接続を確認
- OpenAI APIキーが正しく設定されているか確認

---

## テスト完了基準

すべてのテストケースが✅ (成功) となった場合、プロジェクトは **本番環境対応可能** と判断されます。

### 必須成功条件:
- [ ] 環境セットアップテスト (1.1-1.2) が全て成功
- [ ] 基本機能テスト (2.1-2.3) が全て成功
- [ ] UI/UXテスト (3.1-3.3) が全て成功
- [ ] 少なくとも1つのAI機能テストが成功
- [ ] CSV統合テストが成功
- [ ] エラーハンドリングが適切に動作

### 推奨成功条件:
- [ ] すべてのパフォーマンステストが成功
- [ ] 統合テストが成功
- [ ] レスポンシブデザインが適切に動作

## 9. 新機能テスト (Phase 1-3)

### 9.1 GUI編集機能テスト

#### 9.1.1 Ctrl+S キーボードショートカットテスト
**実行手順:**
1. モデルを読み込み
2. "モデル編集" ボタンをクリックしてGUI編集モードに入る
3. ノードテキストを編集
4. Ctrl+S を押す

**期待結果:**
- ✅ 保存が実行され、編集モードが終了する
- ✅ 変更が適用される

#### 9.1.2 ドラフト自動保存テスト
**実行手順:**
1. GUI編集モードでノードを編集
2. ページをリロード
3. ドラフト復帰ダイアログで「読み込みますか？」を選択

**期待結果:**
- ✅ 確認ダイアログが表示される
- ✅ 「はい」を選択すると変更が復元される
- ✅ 「いいえ」を選択するとドラフトがクリアされる

### 9.2 バッチ編集機能テスト

#### 9.2.1 バッチ編集モーダル表示テスト
**実行手順:**
1. GUI編集モードに入る
2. 「バッチ編集」ボタンをクリック

**期待結果:**
- ✅ バッチ編集モーダルが表示される
- ✅ ノードテキスト置換、選択肢テキスト置換、ターゲット変更のフィールドが表示される

#### 9.2.2 ノードテキスト一括置換テスト
**実行手順:**
1. バッチ編集モーダルを開く
2. 「ノードテキスト検索・置換」セクションで:
   - 検索フィールドに既存のテキストを入力
   - 置換フィールドに新しいテキストを入力
   - 「適用」ボタンをクリック

**期待結果:**
- ✅ 指定されたテキストが全てのノードで置換される
- ✅ 置換されたノード数が表示される
- ✅ GUIが更新されて変更が反映される

#### 9.2.3 選択肢テキスト一括置換テスト
**実行手順:**
1. バッチ編集モーダルを開く
2. 「選択肢テキスト一括置換」セクションを使用
3. 検索・置換を実行

**期待結果:**
- ✅ 全選択肢のテキストで置換が実行される
- ✅ 変更が即座に反映される

#### 9.2.4 ターゲットノード一括変更テスト
**実行手順:**
1. バッチ編集モーダルを開く
2. 「ターゲットノード一括変更」セクションで:
   - 変更元ノードIDを入力
   - 変更先ノードIDを入力
   - 「適用」ボタンをクリック

**期待結果:**
- ✅ 指定されたターゲット参照が全て変更される
- ✅ 変更先ノードが存在しない場合はエラーが表示される

### 9.3 アドバンスド機能オプトインテスト

#### 9.3.1 アドバンスド機能有効化テスト
**実行手順:**
1. 「アドバンスド」タブをクリック
2. 「アドバンスド機能を有効化」チェックボックスをオン

**期待結果:**
- ✅ アドバンスドタブがタブバーに表示される
- ✅ AI設定、キーバインド設定、言い換え辞書エディタが表示される

#### 9.3.2 キーバインド設定テスト
**実行手順:**
1. アドバンスド機能を有効化
2. キーバインド設定を変更
3. 「キーバインドを保存」ボタンをクリック
4. 変更したキーを押して動作を確認

**期待結果:**
- ✅ キーバインドが保存される
- ✅ 新しいショートカットキーが機能する

#### 9.3.3 オプトイン設定の永続性テスト
**実行手順:**
1. アドバンスド機能を有効化
2. ページをリロード

**期待結果:**
- ✅ アドバンスド機能の有効化状態が維持される
- ✅ アドバンスドタブが引き続き表示される

## 10. リファクタリング品質テスト

### 10.1 パフォーマンス改善確認テスト
**実行手順:**
1. 大規模モデル（100ノード以上）を読み込み
2. GUI編集モードでノードを追加・編集
3. バッチ編集を実行

**期待結果:**
- ✅ DOM操作が高速に行われる
- ✅ UIの応答性が維持される
- ✅ メモリリークが発生しない

### 10.2 コード品質テスト
**実行手順:**
1. ブラウザの開発者ツールを開く
2. ConsoleタブでJavaScriptエラーがないことを確認
3. Networkタブでリクエストが適切に行われていることを確認

**期待結果:**
- ✅ JavaScript実行時エラーが発生しない
- ✅ 不要なネットワークリクエストが発生しない
- ✅ コンソールに警告/エラーが表示されない
