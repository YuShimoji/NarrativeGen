{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://yushimoji.github.io/narrativegen/schema/playthrough.schema.json",
  "title": "NarrativeGen Playthrough Model",
  "type": "object",
  "required": ["modelType", "startNode", "nodes"],
  "properties": {
    "modelType": { "type": "string", "enum": ["adventure-playthrough"] },
    "startNode": { "type": "string" },
    "flags": { "type": "object", "additionalProperties": { "type": "boolean" } },
    "resources": { "type": "object", "additionalProperties": { "type": "number" } },
    "nodes": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "required": ["id"],
        "properties": {
          "id": { "type": "string" },
          "text": { "type": "string" },
          "choices": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["id", "text", "target"],
              "properties": {
                "id": { "type": "string" },
                "text": { "type": "string" },
                "target": { "type": "string" },
                "conditions": {
                  "type": "array",
                  "items": {
                    "oneOf": [
                      {
                        "type": "object",
                        "required": ["type", "key", "value"],
                        "properties": {
                          "type": { "const": "flag" },
                          "key": { "type": "string" },
                          "value": { "type": "boolean" }
                        },
                        "additionalProperties": false
                      },
                      {
                        "type": "object",
                        "required": ["type", "key", "op", "value"],
                        "properties": {
                          "type": { "const": "resource" },
                          "key": { "type": "string" },
                          "op": { "type": "string", "enum": [">=", "<=", ">", "<", "=="] },
                          "value": { "type": "number" }
                        },
                        "additionalProperties": false
                      },
                      {
                        "type": "object",
                        "required": ["type", "start", "end"],
                        "properties": {
                          "type": { "const": "timeWindow" },
                          "start": { "type": "number" },
                          "end": { "type": "number" }
                        },
                        "additionalProperties": false
                      }
                    ]
                  }
                },
                "effects": {
                  "type": "array",
                  "items": {
                    "oneOf": [
                      {
                        "type": "object",
                        "required": ["type", "key", "value"],
                        "properties": {
                          "type": { "const": "setFlag" },
                          "key": { "type": "string" },
                          "value": { "type": "boolean" }
                        },
                        "additionalProperties": false
                      },
                      {
                        "type": "object",
                        "required": ["type", "key", "delta"],
                        "properties": {
                          "type": { "const": "addResource" },
                          "key": { "type": "string" },
                          "delta": { "type": "number" }
                        },
                        "additionalProperties": false
                      },
                      {
                        "type": "object",
                        "required": ["type", "target"],
                        "properties": {
                          "type": { "const": "goto" },
                          "target": { "type": "string" }
                        },
                        "additionalProperties": false
                      }
                    ]
                  }
                },
                "outcome": {
                  "type": "object",
                  "required": ["type", "value"],
                  "properties": {
                    "type": { "type": "string" },
                    "value": { "type": "string" }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            }
          }
        },
        "additionalProperties": false
      }
    }
  },
  "additionalProperties": false
}
