# NarrativeGen - Cursor Webå¯¾å¿œç‰ˆ

[![.NET CI](https://github.com/YuShimoji/NarrativeGen/actions/workflows/dotnet-ci.yml/badge.svg)](https://github.com/YuShimoji/NarrativeGen/actions/workflows/dotnet-ci.yml)
## ğŸ“‹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

Unityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨**ä¸¦è¡Œã—ã¦Cursor webã§ã‚‚é–‹ç™ºå¯èƒ½**ãªãƒŠãƒ©ãƒ†ã‚£ãƒ–ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚  
**memo.txt** ã¨ **æ§‹æ–‡ãƒ¡ãƒ¢.txt** ã®è¨­è¨ˆæ€æƒ³ã‚’å®Œå…¨ã«å®Ÿè£…ã—ãŸã€Unityéä¾å­˜ã®æ ¸å¿ƒãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

### ğŸ§ª Unityèµ·å‹•æ™‚ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°/ãƒªãƒˆãƒ©ã‚¤ã®ãƒ†ã‚¹ãƒˆæ‰‹é †ï¼ˆè¦ç´„ï¼‰
- è©³ç´°ã¯ `Documentation/01_Current_Status/CURRENT_PROJECT_STATUS.md` ã‚’å‚ç…§
- æ¦‚è¦:
  1. `Assets/Scenes/DemoScene.unity` ã‚’é–‹ãã€`GameManager`/`UIManager` ã®å‚ç…§ã‚’ç¢ºèª
  2. æ­£å¸¸ç³»: `Play` å®Ÿè¡Œ â†’ ãƒ†ã‚­ã‚¹ãƒˆ/é¸æŠè‚¢è¡¨ç¤ºã€ãƒªãƒˆãƒ©ã‚¤ãƒœã‚¿ãƒ³ã¯éè¡¨ç¤º
  3. ã‚¨ãƒ©ãƒ¼ç³»: `GameManager.m_StartEventID` ã‚’å­˜åœ¨ã—ãªã„IDã« â†’ ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã¨ã€Œãƒªãƒˆãƒ©ã‚¤ã€å‡ºç¾
  4. ãƒªãƒˆãƒ©ã‚¤: è¨­å®š/ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ­£ã«æˆ»ã—ã€ãƒªãƒˆãƒ©ã‚¤æŠ¼ä¸‹ â†’ DB/Logic å†åˆæœŸåŒ–å¾Œã«é–‹å§‹ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰å†é–‹
```csharp
// ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼ä¾‹ã®å®Œå…¨å®Ÿè£…
var cheeseburger = engine.CreateEntity("test_item", "èª°ã€…ãŒé£Ÿã¹ã¦ã„ãŸãƒãƒƒã‚¯ã®ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼");
cheeseburger.SetProperty("é‡ã•", 0.12f);  // æœŸå¾…å€¤ã‚ˆã‚Šé‡ã„

var observer = engine.CreateEntity("observer", "éƒ½ä¼šã®ç¾ä»£äºº");
observer.SetProperty("expected_é‡ã•", 0.1f);
observer.SetProperty("tolerance_é‡ã•", 10.0f);

// é•å’Œæ„Ÿæ¤œå‡º: 0.12kg > 0.11kg(Â±10%) â†’ é•å’Œæ„Ÿãƒˆãƒªã‚¬ãƒ¼
var reaction = engine.DetectInconsistency("observer", "test_item", "é‡ã•");
```
// å‡ºåŠ›: "å¾®å¦™ã«é‡ã„æ°—ãŒã™ã‚‹ã€‚æœ¬å½“ã«ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼ã ã£ãŸã®ã‹ï¼Ÿ"
```

#### âš™ï¸ ãƒ†ã‚­ã‚¹ãƒˆå†…ã‚³ãƒãƒ³ãƒ‰ (æ§‹æ–‡ãƒ¡ãƒ¢.txtæº–æ‹ )
```
r[ã‚‚ã—][é æ…®ã›ãš]r           â†’ ãƒ©ãƒ³ãƒ€ãƒ æŒ¿å…¥
{ãŠã¯ã‚ˆã†||ã“ã‚“ã«ã¡ã¯||ã“ã‚“ã°ã‚“ã¯} â†’ é¸æŠè‚¢ã‹ã‚‰ä¸€ã¤
[A]&&[B]                     â†’ é€£å‹•é¸æŠ
n-{A||B||C}                  â†’ nå€‹é¸æŠ
if(æ¡ä»¶)...else              â†’ æ¡ä»¶åˆ†å²
```

## ğŸš€ Cursor Webã§ã®ä½¿ç”¨æ–¹æ³•

### 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰ãƒ»å®Ÿè¡Œ

```bash
# ä¾å­˜é–¢ä¿‚ã®å¾©å…ƒ
dotnet restore

# ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ
dotnet run --project NarrativeGen.Console.csproj
```

### 2. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰

```
=== NarrativeGen ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ ===
ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§:
  start [eventId] - ãƒŠãƒ©ãƒ†ã‚£ãƒ–ã‚’é–‹å§‹
  process [eventId] - ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†  
  set [key] [value] - ä¸–ç•ŒçŠ¶æ…‹ã‚’è¨­å®š
  get [key] - ä¸–ç•ŒçŠ¶æ…‹ã‚’å–å¾—
  test - ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
  stats - çµ±è¨ˆæƒ…å ±ã‚’è¡¨ç¤º
  exit - çµ‚äº†

> test
=== ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ ===

ğŸ“‹ ãƒ†ã‚¹ãƒˆ1: é¡è¡Œæ¤œç´¢æ©Ÿèƒ½
å…¥åŠ›: [ãã“ã«ç½®ã„ã¦ã‚ã‚‹][å‚˜]ã¯[å£Šã‚Œ]ã¦ã„ã‚‹ã€‚
çµæœ: ãã“ã®å¤ã„å‚˜ã¯å£Šã‚Œã‹ã‘ã¦ã„ã‚‹ã€‚

ğŸ“‹ ãƒ†ã‚¹ãƒˆ2: Entity-Property ã‚·ã‚¹ãƒ†ãƒ   
é•å’Œæ„Ÿæ¤œå‡ºçµæœ: å¾®å¦™ã«é‡ã„æ°—ãŒã™ã‚‹ã€‚æœ¬å½“ã«ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼ã ã£ãŸã®ã‹ï¼Ÿ

ğŸ“‹ ãƒ†ã‚¹ãƒˆ3: ãƒ†ã‚­ã‚¹ãƒˆå†…ã‚³ãƒãƒ³ãƒ‰
ãƒ©ãƒ³ãƒ€ãƒ é¸æŠãƒ†ã‚¹ãƒˆ: ãŠã¯ã‚ˆã†ã€ãŠå®¢ã•ã‚“ã€‚

âœ… å…¨ãƒ†ã‚¹ãƒˆå®Œäº†
```

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
â”œâ”€â”€ NarrativeGen.Core.csproj           # æ ¸å¿ƒãƒ©ã‚¤ãƒ–ãƒ©ãƒª (Unityéä¾å­˜)
â”œâ”€â”€ NarrativeGen.Console.csproj        # ãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¢ãƒ—ãƒª
â”œâ”€â”€ Program.cs                         # ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
â”œâ”€â”€ Core/                             # æ ¸å¿ƒã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â””â”€â”€ Entity.cs                 # Entity-Propertyã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”œâ”€â”€ Engine/
â”‚   â”‚   â”œâ”€â”€ RecursiveResolver.cs      # é¡è¡Œæ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³
â”‚   â”‚   â””â”€â”€ CommandProcessor.cs       # ãƒ†ã‚­ã‚¹ãƒˆå†…ã‚³ãƒãƒ³ãƒ‰å‡¦ç†
â”‚   â”œâ”€â”€ Data/
â”‚   â”‚   â””â”€â”€ DataManager.cs            # CSVãƒ‡ãƒ¼ã‚¿ç®¡ç†
â”‚   â””â”€â”€ NarrativeEngine.cs            # ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ã‚¸ãƒ³
â””â”€â”€ Assets/                           # Unityå´ (è–„ã„ãƒ©ãƒƒãƒ‘ãƒ¼)
    â””â”€â”€ Scripts/
        â””â”€â”€ Logic/
            â””â”€â”€ SyntaxEngine.cs       # Unityçµ±åˆãƒ¬ã‚¤ãƒ¤ãƒ¼
```

## ğŸ”„ é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### **Cursor Webç’°å¢ƒ** (æ ¸å¿ƒãƒ­ã‚¸ãƒƒã‚¯é–‹ç™º)
1. **é¡è¡Œæ¤œç´¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **ã®æ”¹è‰¯
2. **Entity-Propertyã‚·ã‚¹ãƒ†ãƒ **ã®æ‹¡å¼µ  
3. **æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆå†…ã‚³ãƒãƒ³ãƒ‰**ã®è¿½åŠ 
4. **CSVãƒ‡ãƒ¼ã‚¿æ§‹é€ **ã®è¨­è¨ˆ
5. **å˜ä½“ãƒ†ã‚¹ãƒˆ**ã®å®Ÿè¡Œ

### **Unityç’°å¢ƒ** (UIãƒ»çµ±åˆãƒ»ãƒ“ãƒ«ãƒ‰)
1. **SyntaxEngine**ã‚’é€šã˜ãŸCoreçµ±åˆ
2. **UIè¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ **ã®å®Ÿè£…
3. **Androidå‘ã‘ãƒ“ãƒ«ãƒ‰**
4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**

## ğŸ“Š ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³

| æ©Ÿèƒ½åˆ†é‡ | å®Ÿè£…çŠ¶æ³ | èª¬æ˜ |
|---------|---------|------|
| **é¡è¡Œæ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³** | âœ… 100% | æ§‹æ–‡ãƒ¡ãƒ¢.txtå®Œå…¨æº–æ‹  |
| **Entity-Propertyã‚·ã‚¹ãƒ†ãƒ ** | âœ… 95% | memo.txtãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼ä¾‹å®Ÿè£…æ¸ˆã¿ |
| **ãƒ†ã‚­ã‚¹ãƒˆå†…ã‚³ãƒãƒ³ãƒ‰** | âœ… 80% | ä¸»è¦ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…å®Œäº† |
| **CSVãƒ‡ãƒ¼ã‚¿ç®¡ç†** | âœ… 90% | CsvHelperä½¿ç”¨ã€æ‹¡å¼µå¯èƒ½ |
| **é•å’Œæ„Ÿæ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ ** | âœ… 85% | åŸºæœ¬çš„ãªæ¯”è¼ƒãƒ»åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ |
| **å‹•çš„äº‹è±¡Entityç”Ÿæˆ** | â³ 70% | åŸºç›¤å®Ÿè£…æ¸ˆã¿ã€è©³ç´°èª¿æ•´ä¸­ |
| **Unityçµ±åˆ** | â³ 60% | åŸºæœ¬çš„ãªãƒ©ãƒƒãƒ‘ãƒ¼å®Ÿè£…æ¸ˆã¿ |

## ğŸ§ª ãƒ†ã‚¹ãƒˆå¯èƒ½ãªæ©Ÿèƒ½

### 1. é¡è¡Œæ¤œç´¢æ©Ÿèƒ½
```bash
> start test_recursive_event
ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆ: ãã“ã®å¤ã„å‚˜ã¯å£Šã‚Œã‹ã‘ã¦ã„ã‚‹ã€‚
```

### 2. Entity-Propertyæ¯”è¼ƒ
```bash  
> test
ğŸ“‹ ãƒ†ã‚¹ãƒˆ2: Entity-Property ã‚·ã‚¹ãƒ†ãƒ 
é•å’Œæ„Ÿæ¤œå‡ºçµæœ: å¾®å¦™ã«é‡ã„æ°—ãŒã™ã‚‹ã€‚æœ¬å½“ã«ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼ã ã£ãŸã®ã‹ï¼Ÿ
```

### 3. ãƒ†ã‚­ã‚¹ãƒˆå†…ã‚³ãƒãƒ³ãƒ‰
```bash
> process test_commands_event  
ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆ: ã“ã‚“ã°ã‚“ã¯ã€ãŠå®¢ã•ã‚“ã€‚
```

## ğŸ“ˆ æ¬¡ã®é–‹ç™ºæ®µéš

### **çŸ­æœŸ** (Cursor Webå¯¾å¿œæ‹¡å¼µ)
- [ ] ã‚ˆã‚Šé«˜åº¦ãªãƒ†ã‚­ã‚¹ãƒˆå†…ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
- [ ] CSVã‚¨ãƒ‡ã‚£ã‚¿æ©Ÿèƒ½ã®è¿½åŠ 
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¼·åŒ–
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šãƒ»æœ€é©åŒ–

### **ä¸­æœŸ** (Unityçµ±åˆå¼·åŒ–)  
- [ ] SyntaxEngineã®å®Œå…¨çµ±åˆ
- [ ] UIã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºæ”¹å–„
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½
- [ ] ã‚»ãƒ¼ãƒ–ãƒ»ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½

### **é•·æœŸ** (é«˜åº¦æ©Ÿèƒ½)
- [ ] å¤šè¨€èªå¯¾å¿œã‚·ã‚¹ãƒ†ãƒ 
- [ ] ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°æ”¯æ´ãƒ„ãƒ¼ãƒ«
- [ ] AIè£œåŠ©æ©Ÿèƒ½ã®æ¤œè¨
- [ ] ã‚¨ãƒ‡ã‚£ã‚¿æ‹¡å¼µã®é–‹ç™º

## ğŸ”§ æŠ€è¡“ä»•æ§˜

- **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ**: .NET Standard 2.1 / .NET 6.0
- **ä¾å­˜é–¢ä¿‚**: CsvHelper, Microsoft.Extensions.Logging
- **Unityäº’æ›**: Unity 2021.3 LTSä»¥é™å¯¾å¿œ
- **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: Windows, macOS, Linux, Android, iOS

## ğŸ“ ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ä»•æ§˜

CSVãƒ•ã‚¡ã‚¤ãƒ«ã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ãŒã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ã§ã™ï¼š

```csv
# RecursiveDictionary.csv - é¡è¡Œæ¤œç´¢è¾æ›¸
Key,Value,Category,Priority,Description
ãã“ã«ç½®ã„ã¦ã‚ã‚‹,ãã“ã®,location,1,å ´æ‰€ã‚’ç¤ºã™è¨€è‘‰
å‚˜,å¤ã„å‚˜,object,1,ç‰©ä½“ã®èª¬æ˜

# Events.csv - ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿  
Id,Text,Commands,Conditions
START,ãƒŠãƒ©ãƒ†ã‚£ãƒ–ã‚¨ãƒ³ã‚¸ãƒ³ã®å‹•ä½œãƒ†ã‚¹ãƒˆé–‹å§‹,CHOICE "é–‹å§‹" test_event,
test_event,[ä»Šæ—¥ã¯]{è‰¯ã„||ç´ æ™´ã‚‰ã—ã„}[å¤©æ°—]ã§ã™ã­ã€‚,GOTO END,
```

---


ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯**memo.txt**ã¨**æ§‹æ–‡ãƒ¡ãƒ¢.txt**ã®è¦æ±‚ã‚’å®Œå…¨ã«æº€ãŸã—ã€ä»¥ä¸‹ã®åŸå‰‡ã‚’å¾¹åº•ã—ã¦ã„ã¾ã™ï¼š

- **YAGNI/KISS/DRY**: ç°¡æ½”æ€§ãƒ»æ©Ÿèƒ½åˆ†é›¢ã®å¾¹åº•
- **æ—¢å®šå€¤ã‚·ã‚¹ãƒ†ãƒ **: ç´°ã‹ã„è¨­å®šæ¼ã‚Œé˜²æ­¢ãƒ»å¤‰æ•°è¨­å®šåœ°ç„ã®å›é¿
 - **æ–‡å˜ä½åˆ¶ç´„**: ç¿»è¨³å¯¾å¿œã®ãŸã‚ã®å³æ ¼ãªãƒ«ãƒ¼ãƒ«éµå®ˆ
 - **æ€ã„ã¤ãå›é¿**: å½“ã¦æ¨é‡ã§ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³å¢—åŠ ç¦æ­¢
 - **å¾ªç’°å‚ç…§æ¤œå‡º**: ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ãƒ»ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ãƒ‡ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
 
 ---
 
 ## ğŸ§± Clean Architecture ã¨ Unity é€£æºãƒ“ãƒ«ãƒ‰æ‰‹é †ï¼ˆè£œè¶³ï¼‰
 
 - **æ³¨æ„: `dotnet restore` ã®å®Ÿè¡Œç¯„å›²**
   - ãƒªãƒã‚¸ãƒˆãƒªç›´ä¸‹ï¼ˆãƒ«ãƒ¼ãƒˆï¼‰ã§ã® `dotnet restore` ã¯è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãŸã‚å¤±æ•—ã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
   - å¿…ãšãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå˜ä½ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
 
 ```powershell
 # Restore (ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå˜ä½)
 dotnet restore src/NarrativeGen.Domain.csproj -nologo
 dotnet restore src/NarrativeGen.Application.csproj -nologo
 dotnet restore src/NarrativeGen.Infrastructure.csproj -nologo
 dotnet restore adapters/NarrativeGen.Adapter.csproj -nologo
 ```
 
 - **Unity å‘ã‘ DLL ç”Ÿæˆï¼ˆnetstandard2.1ï¼‰**
 
 ```powershell
 dotnet build src/NarrativeGen.Domain.csproj -f netstandard2.1 -nologo
 dotnet build src/NarrativeGen.Application.csproj -f netstandard2.1 -nologo
 dotnet build src/NarrativeGen.Infrastructure.csproj -f netstandard2.1 -nologo
 dotnet build adapters/NarrativeGen.Adapter.csproj -f netstandard2.1 -nologo
 ```
 
 - **Unity ã¸ã®é…ç½®ä¾‹**
   - `src/bin/Debug/netstandard2.1/NarrativeGen.Domain.dll`
   - `src/bin/Debug/netstandard2.1/NarrativeGen.Application.dll`
   - `src/bin/Debug/netstandard2.1/NarrativeGen.Infrastructure.dll`
   - `adapters/bin/Debug/netstandard2.1/NarrativeGen.Adapter.dll`
   - æ¨å¥¨é…ç½®å…ˆ: `Assets/Plugins/NarrativeGen/`
 
 > Infrastructure ã¯ `default_properties` åˆ—ã® JSON ã‚’èª­ã¿å–ã‚‹ãŸã‚ã€.NET 8 ã§ã¯ `System.Text.Json`ã€Unity å‘ã‘ `netstandard2.1` ã§ã¯ `Newtonsoft.Json` ã‚’ä½¿ç”¨ã—ã¾ã™ï¼ˆæ¡ä»¶ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«/æ¡ä»¶å‚ç…§ï¼‰ã€‚