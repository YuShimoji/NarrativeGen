# Web Tester デザイン改善・ストーリー作成効率化 仕様書

## 概要
デザイナーがストーリーを効率よく作成するためのUI/UX改善仕様

## 策定日
2025-11-11

## 優先度
**高** - デザイナーのワークフロー効率に直結

---

## 1. ミニマルデザイン化

### 1.1 絵文字→SVGアイコン置換

#### 目的
- カラフルな絵文字を避け、統一感のあるミニマルデザインを実現
- テーマカラーに応じた色調整が可能なアイコンシステム

#### 実装方針
- **Lucide Icons**または**Heroicons**を使用（軽量でReact/Vue不要）
- インラインSVGで実装（外部ライブラリ依存を最小化）
- CSS変数でアイコン色を制御可能に

#### アイコンマッピング

| 機能 | 現在の絵文字 | 新SVGアイコン |
|------|------------|--------------|
| モデル | 📚 | `book-open` |
| 実行 | ▶ | `play` |
| カスタム読込 | 📂 | `folder-open` |
| 編集 | ✏️ | `edit-2` |
| JSON保存 | 💾 | `save` |
| プレビュー | 📖 | `eye` |
| CSV読込 | 📥 | `upload` |
| CSV出力 | 📤 | `download` |
| サイドバー | 👁️ | `layout-sidebar` |
| グラフ全体表示 | - | `maximize-2` |
| グラフリセット | - | `refresh-cw` |
| 設定 | - | `settings` |

#### 技術仕様
```html
<!-- SVGアイコンコンポーネント -->
<svg class="icon icon-sm" aria-label="保存">
  <use href="#icon-save"></use>
</svg>
```

```css
.icon {
  width: 1.25rem;
  height: 1.25rem;
  stroke: var(--icon-color, currentColor);
  fill: none;
  stroke-width: 2;
  vertical-align: middle;
}

.icon-sm { width: 1rem; height: 1rem; }
.icon-md { width: 1.5rem; height: 1.5rem; }
.icon-lg { width: 2rem; height: 2rem; }
```

---

## 2. カラーパレットシステム

### 2.1 設計方針

#### CSS変数ベースのテーマシステム
- 全色をCSS変数で管理
- パレット選択UIから動的に変更可能
- ローカルストレージに保存

#### カラーパレット定義

##### デフォルトパレット（現在）
```css
:root {
  --color-primary: #667eea;
  --color-primary-dark: #764ba2;
  --color-secondary: #3b82f6;
  --color-secondary-dark: #1d4ed8;
  --color-success: #10b981;
  --color-warning: #f59e0b;
  --color-error: #ef4444;
  --color-bg: #fafafa;
  --color-surface: rgba(255, 255, 255, 0.95);
  --color-text: #1f2937;
  --color-text-muted: #6b7280;
  --color-border: rgba(156, 163, 175, 0.3);
  --icon-color: #6b7280;
}
```

##### 追加パレット案

**1. ミニマルグレー**
- Primary: #6B7280
- Secondary: #9CA3AF
- Accent: #374151

**2. フォレストグリーン**
- Primary: #10B981
- Secondary: #059669
- Accent: #047857

**3. オーシャンブルー**
- Primary: #0EA5E9
- Secondary: #0284C7
- Accent: #0369A1

**4. サンセットオレンジ**
- Primary: #F97316
- Secondary: #EA580C
- Accent: #C2410C

**5. ラベンダーパープル**
- Primary: #A78BFA
- Secondary: #8B5CF6
- Accent: #7C3AED

**6. ダークモード**
- Primary: #3B82F6
- Secondary: #60A5FA
- Accent: #93C5FD
- BG: #111827
- Surface: #1F2937
- Text: #F9FAFB

### 2.2 UI実装

#### パレット選択パネル
```
設定 > カラーテーマ
  ○ デフォルト (紫グラデーション)
  ○ ミニマルグレー
  ○ フォレストグリーン
  ○ オーシャンブルー
  ○ サンセットオレンジ
  ○ ラベンダーパープル
  ○ ダークモード
  [カスタム設定]
```

#### カスタム設定UI
- 主要色のカラーピッカー
- プレビュー機能
- リセットボタン

---

## 3. 機能的ボタン配置改善

### 3.1 現状の問題点
- 横一列に並びすぎて視認性が低い
- 機能グループが明確でない
- モバイル表示で崩れやすい

### 3.2 改善案

#### ツールバー形式への変更
```
┌─────────────────────────────────────────────────┐
│ [ファイル▼] [編集▼] [表示▼] [ツール▼] [ヘルプ▼] │
└─────────────────────────────────────────────────┘
```

#### ドロップダウンメニュー構成

**ファイル**
- 新規モデル
- サンプルを開く →
  - linear.json
  - branching_flags.json
  - ...
- カスタムファイルを開く
- 保存 (JSON)
- 名前を付けて保存
- CSVエクスポート
- ---
- 終了

**編集**
- モデルを編集
- 元に戻す / やり直す
- ---
- バッチ編集
- 検索・置換

**表示**
- ストーリービュー
- ノードグラフ
- デバッグパネル
- ---
- サイドバー表示切替
- フルスクリーン

**ツール**
- CSVインポート
- 小説プレビュー
- モデル検証
- ---
- 言い換えツール
- AI支援 (オプション)

**ヘルプ**
- キーボードショートカット
- ドキュメント
- バージョン情報

#### フローティングツールバー（エディタモード）
```
┌──────────────────────────────────────┐
│ [保存] [元に戻す] [やり直す] [プレビュー] │
└──────────────────────────────────────┘
```

### 3.3 レスポンシブ対応
- デスクトップ: ドロップダウンメニュー
- タブレット: アイコン+ラベル
- モバイル: ハンバーガーメニュー

---

## 4. Mermaid風ノードグラフエディタ

### 4.1 設計コンセプト
- 自由配置 → 構造化配置へ変更
- ドラッグ&ドロップで直感的な物語構成
- 自動レイアウトアルゴリズム（階層型）

### 4.2 レイアウトアルゴリズム

#### 階層型レイアウト (Dagre / ELK.js)
```
       [start]
          |
     [choice1]
      /      \
  [path1]  [path2]
      \      /
       [end]
```

#### 実装方針
1. **自動レイアウト**: ノード追加時に自動配置
2. **手動調整可**: ドラッグで微調整可能
3. **スナップ機能**: グリッドにスナップ
4. **整列機能**: 選択ノードを整列

### 4.3 操作仕様

#### ノード操作
- **追加**: ツールバーからドラッグ、またはダブルクリック
- **削除**: 選択してDeleteキー
- **編集**: ダブルクリックでテキスト編集
- **接続**: ノードからドラッグして別ノードへ

#### エッジ（選択肢）操作
- **追加**: ノード端のハンドルからドラッグ
- **削除**: 選択してDeleteキー
- **条件設定**: エッジをクリックして編集パネル表示

#### キャンバス操作
- **パン**: スペース+ドラッグ、または中ボタンドラッグ
- **ズーム**: Ctrl+マウスホイール
- **選択**: クリックまたはドラッグ矩形選択
- **全体表示**: フィット機能

### 4.4 UI構成

```
┌────────────────────────────────────────┐
│ [ノード追加] [整列] [自動レイアウト]     │
├────────────────────────────────────────┤
│                                        │
│         [ノードグラフキャンバス]         │
│                                        │
│                                        │
├────────────────────────────────────────┤
│ プロパティパネル:                       │
│  ノードID: [____]                       │
│  テキスト: [____]                       │
│  選択肢: [追加] [削除]                   │
└────────────────────────────────────────┘
```

### 4.5 技術選定

#### オプション1: React Flow（推奨）
- 軽量で高機能
- TypeScript対応
- カスタマイズ性高い
- **課題**: Reactベース（現在はVanilla JS）

#### オプション2: Cytoscape.js
- Vanilla JS対応
- 豊富なレイアウトアルゴリズム
- **課題**: やや重い

#### オプション3: 自作（段階的移行）
- 現在のD3.jsベースを拡張
- Dagreライブラリでレイアウト計算
- **推奨**: 既存コードとの整合性

---

## 5. ストーリー作成効率化機能（最優先）

### 5.1 クイックノード作成

#### 仕様
- ショートカット: `N`キー
- グラフ上でダブルクリック
- テンプレート選択（会話、選択、情報、バトル等）

#### UI
```
[新規ノード]
テンプレート:
  ○ 会話 (キャラクターの台詞)
  ○ 選択 (プレイヤー選択肢)
  ○ 情報 (状況説明)
  ○ アクション (イベント)
  ○ 空白

ノードID: [自動生成] または [手動入力]
```

### 5.2 選択肢の一括編集

#### 現状の問題
- 選択肢を一つずつ編集する必要がある
- 同じ条件を複数の選択肢に設定するのが面倒

#### 改善案
```
選択肢一括編集:
  選択肢1: [____] → [target1]
  選択肢2: [____] → [target2]
  選択肢3: [____] → [target3]
  
共通条件:
  □ フラグ条件 [____]
  □ リソース条件 [____]
  
共通効果:
  □ フラグ設定 [____]
  □ リソース変更 [____]
  
[一括適用]
```

### 5.3 ノードのコピー&ペースト

#### 仕様
- Ctrl+C / Ctrl+V
- 選択肢も含めてコピー
- IDは自動採番

### 5.4 スニペット機能

#### 定型パターンの保存
```
スニペット:
  - よくある会話パターン
  - 選択分岐
  - フラグチェック
  - リソース取引

使い方:
  1. ノードパターンを作成
  2. 「スニペットとして保存」
  3. 後で呼び出して再利用
```

### 5.5 検索・フィルタ機能

#### ノード検索
- テキスト全文検索
- 条件検索（フラグ使用、リソース使用等）
- ターゲット参照検索（どこからリンクされているか）

#### フィルタ表示
- 特定条件のノードのみ表示
- 到達不可能なノードをハイライト
- 未接続のノードを表示

### 5.6 プレビュー機能強化

#### リアルタイムプレビュー
- 編集中のノードを即座にプレビュー
- 分岐をシミュレート
- 選択肢の条件判定をテスト

#### マルチエンディング確認
- 全エンディングパスを可視化
- 各エンディングへの到達条件表示

---

## 6. 実装優先順位

### Phase 1: 即時実装（今回）
1. **SVGアイコンシステム導入**
2. **カラーパレット機能**
3. **ツールバー形式への移行**
4. **クイックノード作成**
5. **選択肢一括編集**

### Phase 2: 次回実装
1. **Mermaid風グラフエディタ（自動レイアウト）**
2. **ノードコピー&ペースト**
3. **スニペット機能**

### Phase 3: 将来実装
1. **検索・フィルタ機能**
2. **リアルタイムプレビュー**
3. **マルチエンディング可視化**

---

## 7. 技術スタック

### 追加ライブラリ
- **Lucide Icons**: SVGアイコン（CDN）
- **Dagre**: グラフレイアウト計算
- **TinyColor**: 色操作ライブラリ（カラーパレット用）

### 既存技術
- D3.js: グラフ描画
- Vanilla JS: ロジック
- CSS Variables: テーマシステム

---

## 8. 破壊的変更の回避

### 互換性維持
- 既存のモデルフォーマットは変更なし
- 既存機能は全て保持
- 段階的な移行パス

### 移行計画
1. 新UIと旧UIを並行提供（フラグで切り替え）
2. ユーザーテスト期間
3. 旧UI廃止

---

## 9. テスト計画

### ユーザビリティテスト項目
- [ ] 新規ユーザーが10分以内に基本操作を習得できるか
- [ ] ストーリー作成時間が従来の50%以下になるか
- [ ] カラーパレット変更が直感的か

### パフォーマンステスト
- [ ] 500ノード以上のモデルでも快適に動作するか
- [ ] レイアウト計算が1秒以内に完了するか

---

## 10. ドキュメント更新

### 必要な更新
- README.md: 新機能の説明
- ユーザーガイド作成
- チュートリアル動画（将来）

---

## 付録: UIモックアップ

### ツールバー形式
```
┌──────────────────────────────────────────────────────┐
│ NarrativeGen Web Tester                              │
├──────────────────────────────────────────────────────┤
│ [ファイル▼][編集▼][表示▼][ツール▼][ヘルプ▼]  [🎨テーマ] │
├──────────────────────────────────────────────────────┤
│                                                      │
│              [メインコンテンツエリア]                │
│                                                      │
└──────────────────────────────────────────────────────┘
```

### グラフエディタ
```
┌──────────────────────────────────────────────────────┐
│ [+ノード][整列][自動配置][⚙設定]            [検索🔍]  │
├──────────────────────────────────────────────────────┤
│                    │                                 │
│  [ツールパレット]   │   [グラフキャンバス]            │
│   □ 会話ノード     │                                 │
│   □ 選択ノード     │         [start]                 │
│   □ 情報ノード     │            │                    │
│   □ アクション     │         [node1]                 │
│                    │          /   \                  │
│                    │     [node2] [node3]             │
│                    │                                 │
├────────────────────┴─────────────────────────────────┤
│ プロパティ:                                          │
│  ノード: node1                                       │
│  テキスト: [___________________________________]     │
│  選択肢: [選択肢1][選択肢2] [+追加]                  │
└──────────────────────────────────────────────────────┘
```
