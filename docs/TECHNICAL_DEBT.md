# 技術的負債と改善タスク

**最終更新**: 2025-12-12

## 概要

このドキュメントは、プロジェクト内の技術的負債、未完了のリファクタリング、および将来の改善タスクを追跡します。

---

## 🔴 高優先度

### 1. レイアウト問題の完全解決

**状況**: 対応中  
**問題**: IDE プレビュー環境での外部スタイル注入によりレイアウトが崩れる

**現在の対応**:

- CSS を外部ファイルに分離 (`src/styles/main.css`, `gui-editor.css`)
- `main.js` でランタイムスタイル強制適用
- `!important` による上書き

**残タスク**:

- [ ] 通常ブラウザでの動作確認
- [ ] IDE プレビュー環境での動作確認
- [ ] 必要に応じて追加の isolation 対策

### 2. 手動テストの実施

**状況**: 一部実施  
**参照**: `docs/GUI_EDITOR_TEST_GUIDE.md`

**テスト項目**:

- [ ] コピー＆ペースト (Ctrl+C/V)
- [ ] 検索・フィルタ機能
- [ ] スニペット機能
- [ ] カスタムテンプレート
- [ ] リアルタイムプレビュー
- [ ] モデル検証
- [ ] Mermaid プレビュー
- [x] Save/Load（基本ケースのみ）

---

## 🟡 中優先度

### 3. main.js のリファクタリング

**状況**: 未着手  
**問題**: `main.js` が約 2200 行と大きく、複数の責務が混在

**提案する分割**:

```text
main.js (現在: ~2200行)
    ↓ 分割
src/
├── bootstrap.js          # 初期化・環境検出
├── ui-bindings.js        # DOM 要素取得・イベントバインド
├── session-controller.js # セッション管理
└── app.js               # エントリーポイント (各モジュールを統合)
```

**優先度が低い理由**:

- 現在の機能は正常に動作
- 各 UI マネージャーは既に分離済み (`src/ui/`)
- Vite ビルドで単一ファイルにバンドルされる

### 4. index.html のインライン CSS 削除

**状況**: 部分的に完了  
**問題**: 外部 CSS 追加後もインライン CSS が残存（~1600行）

**対応**:

- 外部 CSS が優先されるため機能上は問題なし
- ファイルサイズ削減のため、将来的に削除を検討

### 5. レキシコン拡張

**状況**: 一部実装済み  
**参照**: `docs/reference.md`

**残タスク**:

- [x] GUI からのクイック追加
- [x] モデル埋め込み (`meta.paraphraseLexicon`)
- [x] Lexicon JSON スキーマ定義（`Packages/engine-ts/schemas/lexicon.schema.json`）
- [x] インポート時のスキーマ検証（ajv 等）
- [x] モデルエクスポート時の `meta.paraphraseLexicon` 自動埋め込み

---

## 🟢 低優先度

### 6. チャンクサイズ警告

**状況**: 既知  
**問題**: ビルド時に 500KB 超過警告が出る

```text
(!) Some chunks are larger than 500 kB after minification.
- index-*.js: 641 kB
- cytoscape.esm.js: 442 kB
```

**対応案**:

- `build.rollupOptions.output.manualChunks` で分割
- 動的 import でコード分割
- 現時点では機能に影響なし

### 7. アクセシビリティ改善

**状況**: 未着手  
**タスク**:

- [ ] ARIA ラベル追加
- [ ] キーボードナビゲーション改善
- [ ] スクリーンリーダー対応

### 8. レスポンシブデザイン

**状況**: 未着手  
**タスク**:

- [ ] モバイル対応
- [ ] タブレット対応
- [ ] ブレークポイント設定

---

## ✅ 完了済み

| タスク | 完了日 | 備考 |
|--------|--------|------|
| CSS 外部化 | 2025-12-08 | `src/styles/` に分離 |
| ランタイムスタイル強制適用 | 2025-12-08 | `main.js` 先頭に追加 |
| ドキュメント整理 | 2025-12-08 | 古いファイルをアーカイブ |
| Mermaid 特殊文字エスケープ | 2025-12-06 | |
| Mermaid 予約語回避 | 2025-12-06 | |
| 初期化バグ修正 | 2025-12-06 | |

---

## 更新履歴

- 2025-12-08: 初版作成
- 2025-12-12: レキシコン対応状況と手動テスト状況を更新
