# GUIエディタ 手動テストガイド

**作成日**: 2025-12-03  
**対象**: apps/web-tester GUIエディタ機能

---

## 前提条件（共通）

1. `npm run dev` で Vite 開発サーバー起動済み
2. ブラウザで `http://localhost:5173` を表示
3. テスト用モデル（ノードが複数ある JSON）を読み込み済み
   - 既存のテスト用 JSON をファイルロード、または GUI からノードを 3〜4 個作成

---

## 1. コピー＆ペースト機能

### TC-CP-01: ノード選択ボタンの表示

- **手順**:
  1. モデル読み込み後、GUI 編集モードに入る
  2. 任意のノードカードを確認
- **期待結果**:
  - 各ノードカードのヘッダーに「選択」ボタンが表示される
  - 見た目が他のボタンと調和しており、意味が直感的に理解できる

### TC-CP-02: 選択状態のハイライト

- **手順**:
  1. 任意のノードの「選択」ボタンをクリック
- **期待結果**:
  - 当該ノードカードに `selected` スタイルが反映され、他のノードと明確に区別できる
  - ヘッダー背景や枠線が強調され、「いまこのノードが対象」ということが一目で分かる

### TC-CP-03: Ctrl+C → Ctrl+V によるコピー＆ペースト

- **手順**:
  1. 「選択」されたノード上で、キーボード `Ctrl+C` を押下
  2. その後、`Ctrl+V` を押下
- **期待結果**:
  - ノードリスト内に新しいノードが追加される
  - ID が自動採番される（例: `start_copy`, `start_copy2`）
  - テキスト／選択肢内容が元ノードから正しくコピーされている
  - ステータスバーに「ノード「xxx」をコピーしました」「ノード「xxx_copy」をペーストしました」と表示される

### TC-CP-04: 複数回ペースト時のID採番

- **手順**:
  1. 同じノードを「選択」した状態で、`Ctrl+V` を複数回実行
- **期待結果**:
  - `nodeId_copy`, `nodeId_copy2`, `nodeId_copy3` ... のように、衝突なくユニークな ID が付与される
  - GUI 上でも ID 行にその値が反映されている

---

## 2. 検索・フィルタ機能

### TC-SF-01: 検索 UI の視認性

- **手順**:
  1. GUI編集モードのヘッダー部分を確認
- **期待結果**:
  - 検索ボックス（虫眼鏡アイコン＋入力欄＋クリアボタン）が一目で見つかる
  - プレースホルダ `ノードを検索...` が、用途を明確に説明している
  - フィルタドロップダウンと結果カウントが、近接して配置されており関係性が分かる

### TC-SF-02: ID検索

- **手順**:
  1. 既知のノード ID（一つだけにマッチするもの）を検索欄に入力
- **期待結果**:
  - 対象ノードのみが表示され、それ以外は非表示になる
  - 結果カウントが `1/全体数 ノード` のように更新される
  - クリアボタン押下で検索欄が空になり、すべてのノードが再表示される

### TC-SF-03: テキスト／選択肢検索

- **手順**:
  1. あるノードの本文テキスト、あるいは選択肢テキスト／target に含まれるキーワードを検索
- **期待結果**:
  - キーワードを含むノードだけが表示される（IDだけではなく、本文や選択肢も対象）
  - 大文字・小文字の違いに敏感でない（case-insensitive）

### TC-SF-04: フィルタ機能（選択肢なし）

- **手順**:
  1. フィルタドロップダウンから「選択肢なし」を選択
- **期待結果**:
  - 選択肢配列が空、あるいは未定義のノードのみが表示される
  - 結果カウントがフィルタ条件に応じた数になる

### TC-SF-05: 到達不能ノード / 孤立ノード

- **手順**:
  1. モデルに start から辿れないノード or どこからも参照されていないノードがある状態で、フィルタを切り替え
- **期待結果**:
  - 到達不能ノード: BFS で start から辿れないノードだけが表示される
  - 孤立ノード: どの choice.target にも現れないノードだけが表示される

### TC-SF-06: 検索結果0件の表示

- **手順**:
  1. 存在しないキーワードで検索
- **期待結果**:
  - 結果カウントに「該当なし」と警告色で表示される
  - すべてのノードカードが非表示になる

---

## 3. Mermaid プレビュー

### TC-MR-01: プレビューの起動

- **手順**:
  1. モデル読み込み後、Mermaid プレビュー（Mキー or 対応ボタン）を起動
- **期待結果**:
  - ノードがグラフとして表示される
  - レイアウトが破綻せず、ノード名・遷移矢印が視認可能

### TC-MR-02: GUI編集との連動

- **手順**:
  1. GUIエディタでノード追加／選択肢追加を行い、Mermaid プレビューをリロード
- **期待結果**:
  - グラフに変更内容が正しく反映される

---

## 4. セーブ／ロード

### TC-SL-01: JSON 保存

- **手順**:
  1. GUI 編集後、JSON 保存ボタンからファイルをダウンロード
- **期待結果**:
  - ダウンロードされた JSON に、GUI 上で編集した内容が全て含まれる

### TC-SL-02: JSON 再ロード

- **手順**:
  1. 先ほど保存した JSON を再ロードし、GUIエディタに表示
- **期待結果**:
  - ノード構造や選択肢が保存前と同じ状態で復元される
  - 検索・フィルタ・コピー＆ペーストも問題なく動作する

---

## 5. スニペット機能

### TC-SP-01: スニペットの保存

- **手順**:
  1. GUI編集モードで、テキストと選択肢を持つノードを1つ選択
  2. 「スニペット」ボタンを押してスニペットモーダルを開く
  3. スニペット名を入力し、「保存」ボタンを押下
- **期待結果**:
  - 入力した名前のスニペットがリストに追加される
  - 同じノードを再度保存しようとした場合、適切なバリデーション／メッセージが表示される

### TC-SP-02: スニペットからの挿入

- **手順**:
  1. 既存のスニペットを1つ選択
  2. 「挿入」ボタンを押下
- **期待結果**:
  - ノードリストに新しいノードが追加される
  - テキストと選択肢が元ノードと同じ内容でコピーされている
  - ID はユニークな値（自動採番）になっていいる

### TC-SP-03: スニペットの削除・リネーム

- **手順**:
  1. スニペットリストから任意のスニペットを選択
  2. 「削除」「名前変更」操作を順に実行
- **期待結果**:
  - 削除後、そのスニペットがリストから消える
  - 名前変更後、新しい名前がリストとボタン等に反映される

---

## 6. カスタムテンプレート機能

### TC-CT-01: テンプレート保存

- **手順**:
  1. GUI編集モードで、テンプレート化したいノードを選択
  2. 「クイックノード作成」→「テンプレート管理」ボタンからテンプレート管理モーダルを開く
  3. テンプレート名を入力し、「保存」ボタンを押下
- **期待結果**:
  - 「カスタムテンプレート」グループに新しいテンプレートが追加される
  - localStorage（`narrativegen_custom_templates`）にも保存される

### TC-CT-02: テンプレートからノード作成

- **手順**:
  1. クイックノードモーダルを開き、「カスタムテンプレート」グループから先ほど保存したテンプレートを選択
  2. 必要に応じてノードID／テキストを編集し、「作成」ボタンを押下
- **期待結果**:
  - 新規ノードが作成され、テンプレート元と同じ選択肢構造を持つ
  - ノードID重複時にはエラーメッセージが表示される

### TC-CT-03: テンプレート削除

- **手順**:
  1. テンプレート管理モーダルで任意のカスタムテンプレートの「削除」ボタンを押下
- **期待結果**:
  - 確認ダイアログを経た上でテンプレートが削除される
  - クイックノードモーダルのテンプレート一覧からも消える

---

## 7. リアルタイムプレビューパネル

### TC-LP-01: 選択ノードのプレビュー表示

- **手順**:
  1. GUI編集モードで、右側の「リアルタイムプレビュー」パネルを確認
  2. 任意のノードカードの「選択」ボタンをクリック
- **期待結果**:
  - プレビューパネルにノードIDと本文テキストが表示される
  - ノード選択を切り替えると、プレビュー内容も即座に切り替わる

### TC-LP-02: 選択肢クリックによる遷移

- **手順**:
  1. 選択肢を持つノードを選択し、プレビュー内の選択肢一覧を確認
  2. いずれかの選択肢（有効な target を持つもの）をクリック
- **期待結果**:
  - 対象ノードに GUI 上の選択状態が移動する
  - プレビューパネルも新しいノード内容に更新される

### TC-LP-03: パス表示と再選択

- **手順**:
  1. start から数ホップ離れたノードを選択
  2. プレビューパネル下部の「遷移パス」表示を確認
  3. パス上の任意のノードIDをクリック
- **期待結果**:
  - パスが `start → ... → 選択中ノード` の形で表示される
  - パス上のIDクリックで、対応するノードに選択が移動する

---

## 8. モデル検証ツール（強化版）

### TC-VA-01: 自己参照（SELF_REFERENCE）の検出

- **手順**:
  1. あるノードの選択肢 `target` をそのノード自身のIDに設定
  2. モデル検証を実行
- **期待結果**:
  - 検証結果にカテゴリ「自己参照」が表示される
  - 該当ノードIDをクリックすると GUI 上でそのノードがハイライトされる

### TC-VA-02: デッドエンド（DEAD_END）の検出

- **手順**:
  1. 遷移先を持たないノード（エンディングでない）を1つ用意
  2. モデル検証を実行
- **期待結果**:
  - カテゴリ「デッドエンド」の問題が表示される
  - 詳細に「遷移先がありません」等の情報が含まれる

### TC-VA-03: 未定義フラグ（UNDEFINED_FLAG）の検出

- **手順**:
  1. いずれかの選択肢に「条件: 存在しないフラグ」を設定
  2. そのフラグをどの効果でも `setFlag` していない状態にする
  3. モデル検証を実行
- **期待結果**:
  - カテゴリ「未定義フラグ」の問題が表示される
  - どのノード／選択肢で問題が発生しているかが分かる

### TC-VA-04: ノードテキスト空（EMPTY_NODE_TEXT）の検出

- **手順**:
  1. テキスト空のノードを1つ用意
  2. モデル検証を実行
- **期待結果**:
  - カテゴリ「空テキスト」の情報レベルの問題が表示される

---

## 変更履歴

| 日付 | 内容 |
|------|------|
| 2025-12-03 | 初版作成（コピー＆ペースト、検索・フィルタ、Mermaid、セーブ/ロード） |
| 2025-12-04 | スニペット、カスタムテンプレート、リアルタイムプレビュー、モデル検証強化のテストケース追加 |
