# Web Tester UI改善テスト手順書

## 概要
本ドキュメントは、Web TesterのUI改善（OpenSpec backlogから優先度順に実装）のテスト手順と期待結果を記載しています。

## 改善実装項目

### ✅ 完了項目
1. **サイト全体の縦伸び対処**
2. **ノードグラフの見切れ対処とレスポンシブ対応**
3. **タブクリックイベントの実装**（既存実装確認済み）
4. **コントロールボタンの整理とグループ化**

---

## テスト環境のセットアップ

### 前提条件
- Node.js 20+
- npm
- モダンブラウザ（Chrome, Firefox, Edge推奨）

### 起動手順

```powershell
# プロジェクトルートから
cd apps\web-tester
npm install
npm run dev
```

ブラウザで `http://localhost:5173` にアクセスしてください。

---

## テスト項目

## 1. サイト全体の縦伸び対処

### テスト目的
ページ全体がビューポートに収まり、不要な縦スクロールが発生しないことを確認

### テスト手順

1. Web Testerを起動し、ブラウザでアクセス
2. ブラウザウィンドウを標準サイズ（1920x1080）に設定
3. ページ全体を確認

### 期待結果
- ✅ ページがビューポート内に収まっている
- ✅ コンテンツが縦方向に不必要に伸びていない
- ✅ `.app-container`が`max-height: 100vh`と`overflow: hidden`を持つ
- ✅ スクロールが必要な箇所のみでスクロールバーが表示される

### 検証方法（開発者ツール）
```javascript
// コンソールで実行
document.querySelector('.app-container').style.maxHeight
// => "100vh"

document.querySelector('.content-area').style.overflow
// => "auto"
```

### 異常パターン
- ❌ ページが縦に伸びすぎてビューポート外まで広がる
- ❌ コンテンツが見切れて操作できない

---

## 2. ノードグラフの見切れ対処とレスポンシブ対応

### テスト目的
ノードグラフが親要素に適切に収まり、レスポンシブにサイズ調整されることを確認

### テスト手順

1. Web Testerでサンプルモデル（例: `branching_flags.json`）を読み込む
2. 「ノードグラフ」タブに切り替え
3. グラフが表示されることを確認
4. ブラウザウィンドウをリサイズ（大→小→大）
5. 「全体表示」ボタンをクリック
6. ノードをドラッグして移動
7. マウスホイールでズーム操作

### 期待結果
- ✅ グラフSVGが親要素`.graph-container`の幅・高さに合わせて表示される
- ✅ SVGに`width: 100%; height: 100%;`が適用されている
- ✅ ウィンドウリサイズ時にグラフが追従する
- ✅ 「全体表示」ボタンでグラフ全体がビューに収まる
- ✅ ノードのドラッグ操作が正常に動作する
- ✅ ズーム操作（マウスホイール）が正常に動作する
- ✅ グラフが見切れず、スクロールで全体を確認できる

### 検証方法（開発者ツール）
```javascript
// コンソールで実行
const svg = document.getElementById('graphSvg')
console.log('SVG width:', svg.style.width) // => "100%"
console.log('SVG height:', svg.style.height) // => "100%"

// 親要素のサイズ
const container = document.querySelector('.graph-container')
console.log('Container size:', container.clientWidth, 'x', container.clientHeight)
```

### 異常パターン
- ❌ グラフが固定サイズで表示され、親要素からはみ出る
- ❌ ウィンドウリサイズ時にグラフサイズが変わらない
- ❌ ノードが見切れて操作できない

---

## 3. タブクリックイベントの実装

### テスト目的
タブをクリックして切り替えができることを確認

### テスト手順

1. Web Testerを起動
2. 各タブ（ストーリー、ノードグラフ、デバッグ）を順番にクリック
3. キーボードショートカット（S, G, D）でもタブ切り替えを試す

### 期待結果
- ✅ 「ストーリー」タブクリックで`#storyPanel`が表示される
- ✅ 「ノードグラフ」タブクリックで`#graphPanel`が表示される
- ✅ 「デバッグ」タブクリックで`#debugPanel`が表示される
- ✅ アクティブなタブに`.active`クラスが付与される
- ✅ キーボードショートカットでも同様に動作する

### 検証方法（開発者ツール）
```javascript
// コンソールで実行
document.getElementById('storyTab').click()
console.log('Story panel active:', document.getElementById('storyPanel').classList.contains('active'))

document.getElementById('graphTab').click()
console.log('Graph panel active:', document.getElementById('graphPanel').classList.contains('active'))
```

### 異常パターン
- ❌ タブをクリックしても何も起こらない
- ❌ 複数のパネルが同時に表示される
- ❌ アクティブなタブが視覚的に識別できない

---

## 4. コントロールボタンの整理とグループ化

### テスト目的
コントロールボタンが論理的にグループ化され、直感的に操作できることを確認

### テスト手順

1. Web Testerの「ストーリー」タブを開く
2. コントロールエリアのボタン配置を確認
3. 各グループのボタンを順番に操作

### 期待結果

#### ボタングループ構成
- ✅ **グループ1: モデルの読み込み**
  - 📚 モデル（セレクトボックス）
  - ▶ 実行
  - 📂 カスタム読込
  
- ✅ **グループ2: モデルの編集と出力**
  - ✏️ 編集
  - 💾 JSON保存
  - 📖 プレビュー
  
- ✅ **グループ3: スプレッドシート連携**
  - 📥 CSV読込
  - 📤 CSV出力
  
- ✅ **グループ4: 表示設定**
  - 👁️ サイドバー

#### 視覚的要件
- ✅ 各グループが`.control-group`でラップされている
- ✅ 絵文字アイコンがボタンラベルに含まれている
- ✅ ツールチップ（title属性）が各グループに設定されている
- ✅ グループ間に適切な視覚的区切りがある

### 検証方法（開発者ツール）
```javascript
// コンソールで実行
const groups = document.querySelectorAll('.control-group')
console.log('Number of control groups:', groups.length) // => 4

groups.forEach((group, i) => {
  console.log(`Group ${i + 1} title:`, group.getAttribute('title'))
  console.log(`Group ${i + 1} buttons:`, group.querySelectorAll('button').length)
})
```

### 機能テスト
各ボタンをクリックして、期待通りの動作をすることを確認：

1. **▶ 実行**: 選択したモデルを読み込み、ストーリーが表示される
2. **📂 カスタム読込**: ファイル選択ダイアログが開く
3. **✏️ 編集**: GUIエディタモードに切り替わる
4. **💾 JSON保存**: JSONファイルがダウンロードされる
5. **📖 プレビュー**: 小説プレビューモーダルが開く
6. **📥 CSV読込**: CSVファイル選択ダイアログが開く
7. **📤 CSV出力**: CSVファイルがダウンロードされる
8. **👁️ サイドバー**: サイドバーの表示/非表示が切り替わる

### 異常パターン
- ❌ ボタンが論理的にグループ化されていない
- ❌ ボタンラベルが不明確で何をするか分からない
- ❌ ボタンクリック時に何も起こらない、または意図しない動作をする

---

## 5. 統合テスト（シナリオベース）

### シナリオ1: 初回利用ユーザーの基本フロー

1. Web Testerを初めて開く
2. サンプルモデル「linear.json」を選択
3. 「▶ 実行」をクリック
4. ストーリーが表示され、選択肢が提示される
5. 選択肢をクリックしてストーリーを進める
6. 「ノードグラフ」タブに切り替える
7. グラフでストーリー構造を確認
8. 「全体表示」でグラフ全体を確認

**期待結果**: 全ての操作がスムーズに行え、UIが直感的に理解できる

### シナリオ2: モデル編集とエクスポート

1. サンプルモデル「branching_flags.json」を読み込む
2. 「✏️ 編集」をクリック
3. GUIエディタでノードテキストを変更
4. 「💾 JSON保存」で編集したモデルを保存
5. 「📤 CSV出力」でCSV形式でもエクスポート

**期待結果**: 編集、保存、エクスポートが正常に完了する

### シナリオ3: レスポンシブ動作確認

1. ブラウザウィンドウを1920x1080に設定
2. 各タブを確認
3. ウィンドウを縮小（1366x768, 1024x768）
4. 再度各タブを確認
5. モバイルサイズ（375x667）でも確認

**期待結果**: 全てのサイズで適切にレイアウトが調整され、操作可能

---

## 6. ブラウザ互換性テスト

以下のブラウザで基本動作を確認：

- [ ] Google Chrome（最新版）
- [ ] Mozilla Firefox（最新版）
- [ ] Microsoft Edge（最新版）
- [ ] Safari（macOSの場合）

### 各ブラウザでの確認項目
1. ページレイアウトが正常
2. タブ切り替えが動作
3. グラフ表示とインタラクション（ドラッグ、ズーム）が動作
4. ボタンが全て正常に機能

---

## 7. パフォーマンステスト

### テスト手順

1. 大規模モデル（100ノード以上）を読み込む
2. 各タブの表示速度を確認
3. グラフのレンダリング時間を測定
4. ブラウザの開発者ツールでパフォーマンスプロファイルを取得

### 期待結果
- ✅ タブ切り替えが0.5秒以内
- ✅ グラフレンダリングが2秒以内（100ノードの場合）
- ✅ メモリリークが発生しない
- ✅ CPU使用率が合理的な範囲内

---

## トラブルシューティング

### 問題: グラフが表示されない

**原因**: D3.jsが読み込まれていない、またはモデルデータが不正

**解決方法**:
1. ブラウザコンソールでエラーを確認
2. `d3`がグローバルに存在するか確認: `console.log(typeof d3)`
3. モデルデータの構造を確認

### 問題: ボタンをクリックしても反応しない

**原因**: JavaScriptエラー、またはイベントリスナー未登録

**解決方法**:
1. ブラウザコンソールでエラーログを確認
2. 開発サーバーを再起動
3. キャッシュをクリアしてページをリロード

### 問題: レイアウトが崩れる

**原因**: CSSが正しく適用されていない、または外部スタイルが上書きされている

**解決方法**:
1. 開発者ツールでCSSスタイルを確認
2. `apps/web-tester/src/styles/main.css` および `gui-editor.css` の内容を確認
3. IDE拡張などが独自のCSSを注入していないか確認
4. ブラウザキャッシュをクリアしてリロード

---

## テスト完了チェックリスト

- [ ] サイト全体の縦伸び対処が正常に動作
- [ ] ノードグラフがレスポンシブに表示される
- [ ] タブクリックイベントが正常に動作
- [ ] コントロールボタンが整理され直感的に操作できる
- [ ] 統合テストシナリオが全て成功
- [ ] 主要ブラウザで互換性確認完了
- [ ] パフォーマンスが許容範囲内

---

## テスト実施記録

| 実施日 | 実施者 | 環境（OS/Browser） | 対象バージョン（branch/commit） | 結果 | 備考 |
|------|--------|-------------------|-------------------------------|------|------|
| 2025-12-14 | Cascade | Windows / Puppeteer(Chromium) | lexicon-ux-ajv-packages-casing / f907892 | ✅ | スモーク: 起動/実行/タブ切替/グラフ描画/GUI編集入退場 | 

## フィードバックとバグ報告

テスト中に問題を発見した場合、以下の情報を含めてGitHub Issueに報告してください：

1. **問題の詳細説明**
2. **再現手順**
3. **期待される動作**
4. **実際の動作**
5. **環境情報**（OS、ブラウザ、バージョン）
6. **スクリーンショットまたはエラーログ**

---

## 更新履歴

- 2025-11-11: 初版作成（UI改善実装完了に伴うテスト手順書）
