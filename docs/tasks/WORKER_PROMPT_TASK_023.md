# Worker Prompt: TASK_023 マルチエンディング可視化機能拡張実装

## タスク概要

マルチエンディング可視化機能を拡張実装してください。インタラクティブなパス追跡、エンディング条件の詳細分析、統計情報の表示、エクスポート機能を追加し、ストーリー構造の理解を支援します。

## 前提条件

- TASK_017（マルチエンディング可視化機能）が完了済み
- 基本的なエンディングパス抽出機能が実装済み
- リアルタイムプレビューパネルが実装済み

## 実装範囲

### 1. インタラクティブなパス追跡
- エンディングパスのクリックでのハイライト
- パス上のノード・選択肢の詳細表示
- パスのアニメーション表示（1秒かけて追跡）
- パスのフォーカス・アンフォーカス機能
- パス間の切り替えアニメーション

### 2. エンディング条件の詳細分析
- 到達条件の複雑度評価（条件数のカウント）
- 条件の依存関係グラフ表示
- 未到達可能なエンディングの検出
- 条件の重複・冗長性チェック
- 条件のカバレッジ分析

### 3. 統計情報の表示
- 各エンディングへの到達率（理論値）
- 条件の使用頻度分析
- ストーリーの分岐度・複雑度指標
- ノードタイプの分布グラフ
- 選択肢の分岐率統計

### 4. エクスポート機能
- エンディング構造のテキストエクスポート
- 条件リストのCSVエクスポート
- 可視化グラフのPNG/SVGエクスポート
- 統計情報のJSONエクスポート
- レポート形式のPDFエクスポート

## 技術要件

### ファイル構成
- `apps/web-tester/src/ui/ending-analyzer.js` - 分析エンジン
- `apps/web-tester/src/ui/path-tracker.js` - パス追跡機能
- `apps/web-tester/src/ui/stats-panel.js` - 統計パネル
- `apps/web-tester/src/utils/export-utils.js` - エクスポート機能

### データ構造
```javascript
// エンディング分析結果
{
  endingId: "ending_001",
  title: "Normal Ending",
  reachability: 0.75,
  conditions: [
    { type: "flag", name: "hero_level", operator: ">=", value: 10 },
    { type: "timeWindow", start: "day3", end: "day5" }
  ],
  complexity: 3,
  pathLength: 15,
  dependencies: ["ending_002", "ending_003"]
}
```

### 使用ライブラリ
- D3.js（依存関係グラフ表示）
- html2canvas（画像エクスポート）
- jsPDF（PDFエクスポート）
- 既存のグラフライブラリ

### パフォーマンス要件
- 100エンディングの分析が5秒以内に完了
- パス追跡アニメーションが60fpsで動作
- 統計情報のリアルタイム更新

## 実装手順

1. **パス追跡機能実装**
   - エンディングパスのクリックイベント処理
   - ハイライト表示のCSSアニメーション
   - パス追跡のアニメーションロジック

2. **条件分析エンジン実装**
   - 条件の複雑度評価アルゴリズム
   - 依存関係グラフの生成
   - 未到達エンディングの検出ロジック

3. **統計パネル実装**
   - 統計情報の計算処理
   - グラフ表示のUIコンポーネント
   - リアルタイム更新の仕組み

4. **エクスポート機能実装**
   - 各形式のエクスポート処理
   - ファイルダウンロードのUI
   - エクスポートデータの整形

## 禁止事項

- エンジンコアの仕様変更
- 既存データ形式の破壊的変更
- 外部APIへの依存追加
- クライアントサイドでの重い計算処理（Web Worker使用を推奨）

## 完了条件（DoD）

- [ ] インタラクティブなパス追跡が動作する
- [ ] エンディング条件の詳細分析が表示される
- [ ] 統計情報が正しく計算・表示される
- [ ] 全形式のエクスポート機能が動作する
- [ ] 既存可視化機能との統合が完了する
- [ ] 複雑なストーリー（50エンディング）で動作確認
- [ ] docs/inbox/にREPORT_TASK_023_*.mdを作成する

## テスト手順

1. 複雑なサンプルモデル（branching_flags.json）を読み込む
2. マルチエンディング可視化を開始
3. エンディングパスをクリックし、ハイライトを確認
4. 条件分析パネルで詳細情報を確認
5. 統計パネルで各種情報を確認
6. エクスポート機能をテスト（PNG/CSV/JSON）
7. 大規模モデルでのパフォーマンスを確認

## 報告要件

実装完了後、以下の内容を含むレポートを作成してください：

1. 実装内容の詳細
2. パス追跡機能の動作確認結果
3. 条件分析アルゴリズムの評価
4. 統計情報の正確性検証
5. エクスポート機能のテスト結果
6. パフォーマンス測定結果

レポートは `docs/inbox/REPORT_TASK_023_YYYYMMDD.md` として保存してください。
