# Worker Prompt: TASK_021 Phase 2グラフビュー高度編集機能実装

## タスク概要

Phase 2グラフビューに高度編集機能を実装してください。ミニマップ、複数選択・一括移動、グリッドスナップ、条件・効果のインジケータ表示を追加し、ビジュアルエディタとしての機能を強化します。

## 前提条件

- TASK_013（Phase 2読み取り専用グラフビュー）が完了済み
- TASK_015（Phase 2グラフビュー編集機能）が完了済み
- Dagre.jsによる基本的なグラフレイアウトが実装済み

## 実装範囲

### 1. ミニマップ実装
- グラフ全体の縮小版を右下に表示
- クリックで特定領域にジャンプ
- 現在表示範囲の矩形ハイライト
- ズームイン・アウト機能

### 2. 複数選択・一括移動
- Ctrl+クリックでの複数選択
- Shift+ドラッグでの範囲選択
- 選択ノードの一括移動・削除
- 選択状態の視覚的フィードバック

### 3. グリッドスナップ
- ノード位置のグリッド合わせ（20px間隔）
- スナップ間隔の設定機能（10px/20px/40px）
- スナップのON/OFF切り替え（トグルボタン）
- スナップ時の視覚的ガイドライン

### 4. 条件・効果のインジケータ表示
- ノードの条件（flags、timeWindow等）をアイコンで表示
- エッジの効果（next、onEnter等）を矢印の色/形で表現
- インジェクターのクリックで詳細情報をポップアップ表示
- 条件の有無によるノード境界線の色分け

## 技術要件

### ファイル構成
- `apps/web-tester/src/ui/graph-editor.js` - メイン実装ファイル
- `apps/web-tester/src/styles/graph.css` - スタイル定義
- `apps/web-tester/src/utils/graph-utils.js` - ユーティリティ関数

### 使用ライブラリ
- Dagre.js（既存）
- D3.js（ミニマップ実装用）
- 既存のCSSフレームワーク

### パフォーマンス要件
- 1000ノード以上のグラフで遅延なく動作
- ミニマップの更新は60fpsを維持
- 複数選択時のメモリ使用量を最適化

## 実装手順

1. **ミニマップ実装**
   - D3.jsを使用してミニマップコンポーネント作成
   - グラフ全体のスケール変換と表示
   - クリックイベントでのメインビュー移動

2. **複数選択機能実装**
   - 選択状態管理のデータ構造拡張
   - マウスイベント処理の追加
   - 選択範囲の矩形描画

3. **グリッドスナップ実装**
   - グリッド計算関数の実装
   - ノード移動時のスナップ処理
   - 設定UIの追加

4. **インジケータ表示実装**
   - 条件・効果の解析関数実装
   - インジェクターSVG要素の動的生成
   - ポップアップ情報表示の実装

## 禁止事項

- エンジンコアの仕様変更
- 既存データ形式の破壊的変更
- 外部APIへの依存追加
- パフォーマンスに大幅な影響を与える実装

## 完了条件（DoD）

- [ ] ミニマップが正しく表示され、クリックで移動できる
- [ ] 複数選択がCtrl+クリックと範囲選択で動作する
- [ ] グリッドスナップが設定通りに動作する
- [ ] 条件・効果のインジケータが正しく表示される
- [ ] 既存機能との統合テストが完了する
- [ ] 大規模グラフ（1000ノード）でパフォーマンス問題がない
- [ ] docs/inbox/にREPORT_TASK_021_*.mdを作成する

## テスト手順

1. サンプルモデル（dragon_quest_v3.csv）を読み込む
2. ミニマップが表示されることを確認
3. ミニマップをクリックしてビューが移動することを確認
4. Ctrl+クリックで複数ノード選択を確認
5. 選択ノードの一括移動を確認
6. グリッドスナップをON/OFFして動作を確認
7. 条件を持つノードのインジケータ表示を確認

## 報告要件

実装完了後、以下の内容を含むレポートを作成してください：

1. 実装内容の詳細
2. 各機能の動作確認結果
3. パフォーマンス測定結果
4. 既存機能への影響評価
5. 今後の拡張提案

レポートは `docs/inbox/REPORT_TASK_021_YYYYMMDD.md` として保存してください。
