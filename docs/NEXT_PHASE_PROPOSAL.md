# Web Tester 次フェーズ開発提案

## 概要
Phase 1（SVGアイコン、カラーパレット、基本効率化機能）完了に基づく、次フェーズの開発提案

## 策定日
2025-11-11

---

## Phase 1完了状況

### ✅ 完了機能
1. **SVGアイコンシステム**
   - 絵文字からミニマルSVGアイコンへ置換
   - 統一感のあるデザイン実現

2. **カラーパレット機能**
   - 6種類のプリセットテーマ
   - ローカルストレージ保存

3. **ストーリー作成効率化（基礎）**
   - クイックノード作成
   - 選択肢一括編集

### 📊 ユーザーフィードバック待ち項目
- UIの使いやすさ
- カラーパレットの好み
- 効率化機能の実用性
- 追加してほしい機能

---

## Phase 2: Mermaid風グラフエディタ（集中開発）

### 目的
現在のD3.js自由配置グラフから、構造化された直感的なグラフエディタへ移行

### 主要機能

#### 1. 自動レイアウトアルゴリズム
**技術選定：Dagre.js**
- 階層型レイアウト（トップダウン）
- ノード追加時の自動配置
- 衝突回避

#### 2. ドラッグ＆ドロップ物語構成
**操作方法：**
- ツールパレットからノードタイプをドラッグ
- キャンバスにドロップして作成
- ノード間をドラッグして接続作成
- グリッドスナップ機能

#### 3. ビジュアルノードタイプ
```
[開始] → [会話] → [選択] → [分岐]
                       ↓
                    [エンディング]
```

ノードタイプごとに色分け：
- 開始：緑
- 会話：青
- 選択：黄
- 分岐：オレンジ
- エンディング：赤
- 情報：グレー

#### 4. インライン編集
- ノードダブルクリックで即座に編集
- モーダル不要
- リアルタイムプレビュー

#### 5. ミニマップ
- 大規模グラフの全体把握
- クリックで移動

### 実装計画

#### ステップ1：基盤構築（2-3日）
- [ ] Dagre.jsライブラリ統合
- [ ] 新グラフエディタタブ作成
- [ ] 基本レイアウトエンジン実装

#### ステップ2：ノード操作（2-3日）
- [ ] ツールパレット実装
- [ ] ドラッグ＆ドロップ機能
- [ ] ノードタイプ別スタイル
- [ ] インライン編集

#### ステップ3：エッジ（選択肢）操作（1-2日）
- [ ] ドラッグで接続作成
- [ ] 条件・効果の設定UI
- [ ] ビジュアルフィードバック

#### ステップ4：高度機能（1-2日）
- [ ] グリッドスナップ
- [ ] 複数選択・整列
- [ ] ミニマップ
- [ ] ズーム・パン最適化

#### ステップ5：既存機能との統合（1日）
- [ ] 既存グラフとの切り替え
- [ ] データ互換性確保
- [ ] モデル保存/読み込み

**合計推定時間：7-11日**

### UI設計

```
┌────────────────────────────────────────────────────┐
│ [ファイル] [編集] [表示] [ツール]    [設定] [ヘルプ] │
├────────────────────────────────────────────────────┤
│ ツールパレット │  キャンバス                        │
│ ┌──────────┐  │                                   │
│ │ 🟢 開始   │  │         [開始]                    │
│ │ 🔵 会話   │  │            │                      │
│ │ 🟡 選択   │  │         [会話1]                   │
│ │ 🟠 分岐   │  │         /     \                   │
│ │ 🔴 終了   │  │    [選択A]  [選択B]              │
│ │ ⚪ 情報   │  │        │        │                │
│ └──────────┘  │    [終了]   [終了]               │
│              │                                   │
├──────────────┴───────────────────────────────────┤
│ プロパティパネル                                   │
│ ノードID: [conversation_1]                        │
│ テキスト: [__________________________________]    │
│ 選択肢: [追加] [削除]                             │
└────────────────────────────────────────────────────┘
```

---

## Phase 3: ストーリー作成効率化（拡張）

Phase 1で基礎を実装済み。以下の機能を追加：

### 1. ノードコピー＆ペースト
- **ショートカット：** `Ctrl+C` / `Ctrl+V`
- 選択肢も含めて完全コピー
- ID自動採番

### 2. スニペット機能
定型パターンを保存・再利用：
- 会話パターン
- 選択分岐
- フラグチェック
- リソース取引

**UI：**
```
[スニペット]
  📋 よくある会話パターン
  📋 二択分岐
  📋 フラグチェック付き選択
  📋 リソース消費イベント
  [+ 新規スニペット作成]
```

### 3. 検索・フィルタ機能
**ノード検索：**
- 全文検索
- 条件検索（フラグ使用、リソース使用等）
- ターゲット参照検索

**フィルタ表示：**
- 到達不可能ノードをハイライト
- 未接続ノードを表示
- 特定条件でフィルタ

**UI：**
```
[🔍 検索]  [フィルタ▼]
  ○ すべて表示
  ○ 到達不可能ノードのみ
  ○ 未接続ノードのみ
  ○ フラグ使用ノードのみ
  ○ リソース使用ノードのみ
```

### 4. ノードテンプレート拡張
Phase 1の5種類から10種類以上へ拡張：
- キャラクター別会話テンプレート
- バトルイベント
- ショップ取引
- クエスト受注/完了
- タイムゲート
- 複数エンディング分岐

**カスタムテンプレート：**
- ユーザーが独自テンプレートを作成・保存
- プロジェクト間で共有可能

### 5. バッチ操作強化
Phase 1の選択肢一括編集を拡張：
- ノードテキスト一括置換
- ターゲット一括変更
- 条件・効果の一括削除
- 正規表現サポート

---

## Phase 4: プレビュー＆検証機能

### 1. リアルタイムプレビュー
**機能：**
- 編集中のノードを即座にプレビュー
- サイドパネルでストーリーフロー確認
- デバッグモード（フラグ・リソース表示）

**UI：**
```
┌─────────────┬──────────────────────┐
│ エディタ     │ ライブプレビュー      │
│             │                      │
│ [node1]     │ 「ようこそ！」        │
│  text: ...  │                      │
│  choices:   │ > 話を聞く           │
│    - c1     │ > 立ち去る           │
│    - c2     │                      │
└─────────────┴──────────────────────┘
```

### 2. マルチエンディング可視化
- 全エンディングパスを自動抽出
- ツリー構造で表示
- 各エンディングへの到達条件表示

**UI：**
```
エンディング一覧:
  🟢 エンディングA (条件: flag:heroic=true)
     └─ 到達パス: start → scene1 → choice_help → ending_a
  🔵 エンディングB (条件: flag:peaceful=true)
     └─ 到達パス: start → scene1 → choice_talk → ending_b
  🔴 エンディングC (条件: resource:gold>=100)
     └─ 到達パス: start → shop → buy_item → ending_c
```

### 3. モデル検証ツール
**自動チェック：**
- 到達不可能ノード検出
- 無限ループ検出
- 条件の矛盾検出
- 参照エラー検出

**検証レポート：**
```
検証結果:
  ⚠️ 警告 2件
    - node_orphan: 到達不可能（どこからもリンクされていません）
    - choice_broken: ターゲット'missing_node'が存在しません
  ✅ エラー 0件
```

---

## Phase 5: コラボレーション＆エクスポート機能

### 1. バージョン管理統合
- Gitライクな変更履歴
- コミット・ロールバック機能
- 差分表示

### 2. マルチユーザー編集（将来）
- リアルタイムコラボレーション
- ロック機能（編集中ノードのロック）
- 変更通知

### 3. エクスポート機能拡張
**現在：** JSON, CSV

**追加：**
- Twine互換形式
- Inkフォーマット
- Yarn Spinner形式
- Excel/Google Sheets
- PDF（フローチャート）

---

## Phase 6: パフォーマンス＆UX改善

### 1. 大規模モデル対応
- 仮想化スクロール強化
- 遅延読み込み
- インクリメンタル保存

### 2. ショートカット拡張
**追加予定：**
- `Ctrl+Z` / `Ctrl+Y`: 元に戻す/やり直す
- `Ctrl+F`: 検索
- `Ctrl+D`: 選択複製
- `Delete`: ノード削除
- `Space`: パンモード切り替え

### 3. ツールチップ＆ヘルプ
- インタラクティブチュートリアル
- 各機能のツールチップ
- ヘルプドキュメント統合

---

## 優先度マトリクス

| フェーズ | 機能 | 優先度 | 工数 | 依存関係 |
|---------|------|-------|------|---------|
| Phase 2 | Mermaid風グラフ | **高** | 7-11日 | なし |
| Phase 3 | コピー＆ペースト | **高** | 1日 | なし |
| Phase 3 | スニペット | 中 | 2-3日 | コピー＆ペースト |
| Phase 3 | 検索・フィルタ | **高** | 2-3日 | なし |
| Phase 3 | テンプレート拡張 | 中 | 1-2日 | なし |
| Phase 4 | リアルタイムプレビュー | **高** | 2-3日 | なし |
| Phase 4 | マルチエンディング可視化 | 中 | 2-3日 | グラフエディタ |
| Phase 4 | モデル検証ツール | **高** | 2-3日 | なし |
| Phase 5 | バージョン管理 | 低 | 5-7日 | なし |
| Phase 5 | エクスポート拡張 | 中 | 3-5日 | なし |
| Phase 6 | パフォーマンス | 中 | 継続的 | なし |
| Phase 6 | ショートカット | 中 | 1-2日 | なし |

---

## 推奨実装順序

### 即時実装（1-2週間）
1. **Phase 2: Mermaid風グラフエディタ** （最優先）
   - ストーリー作成の中核機能
   - ユーザー体験の大幅改善

2. **Phase 3: コピー＆ペースト + 検索フィルタ**
   - 効率化の基本機能
   - 短期間で実装可能

3. **Phase 4: モデル検証ツール**
   - エラー防止に重要
   - デザイナーの作業を支援

### 次期実装（2-4週間後）
1. **Phase 3: スニペット機能**
2. **Phase 4: リアルタイムプレビュー**
3. **Phase 3: テンプレート拡張**

### 将来実装（3ヶ月以降）
1. **Phase 4: マルチエンディング可視化**
2. **Phase 5: エクスポート機能拡張**
3. **Phase 5: バージョン管理**
4. **Phase 6: 継続的改善**

---

## ユーザーテストポイント

Phase 1実装後、以下を確認：

### 定量評価
- [ ] ノード作成時間（Phase 1 vs 旧方式）
- [ ] エラー発生率
- [ ] ユーザー満足度スコア

### 定性評価
- [ ] UIの直感性
- [ ] 機能の発見しやすさ
- [ ] 学習曲線

### フィードバック収集
- [ ] 最も使う機能は？
- [ ] 使いにくい点は？
- [ ] 追加してほしい機能は？

---

## 技術的考慮事項

### Mermaid風グラフエディタ
**技術スタック：**
- Dagre.js：レイアウト計算
- 現行D3.js：描画エンジン（再利用）
- TypeScript：型安全性

**移行戦略：**
1. 新エディタを別タブで実装
2. 旧グラフと並行提供
3. ユーザーテスト後に統合判断

### パフォーマンス目標
- 500ノードモデルで60fps維持
- レイアウト計算1秒以内
- メモリ使用量200MB以下

---

## まとめ

### 次の一手
**最優先：Phase 2 - Mermaid風グラフエディタ**

理由：
1. ストーリー作成の中核機能
2. ユーザー体験の劇的改善
3. 他機能の基盤となる

### 期待される効果
- ストーリー作成時間：**50%削減**
- エラー発生率：**70%削減**
- ユーザー満足度：**大幅向上**

### リスクと対策
**リスク：** 大規模実装による遅延
**対策：** 段階的実装、早期テスト、フィードバックループ

---

## フィードバックをお待ちしています

Phase 1の使用感を確認後、Phase 2の詳細設計に進みます。

**重要な質問：**
1. Phase 1の機能は期待通りですか？
2. 最も重要だと思う次の機能は？
3. Mermaid風グラフエディタに期待する機能は？
