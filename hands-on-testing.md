# 🧪 ハンズオン テスト手順

## 📋 テストの概要

このガイドでは、NarrativeGen の各機能を実際にテストする方法をステップバイステップで説明します。所要時間：約15-30分

### 🎯 テスト目標
- ✅ 基本機能（モデル読み込み、セッション実行）が正常動作
- ✅ AI 機能（モック + OpenAI）が適切に動作
- ✅ エラーハンドリングが正しく機能
- ✅ ユーザー体験が良好

---

## 🚀 ステップ 1: 環境準備

### 1.1 依存関係のインストール
```bash
# プロジェクトルートで実行
npm install
```

### 1.2 全パッケージのビルド
```bash
# エンジンとWeb Testerを同時にビルド
npm run build:all
```

### 1.3 開発サーバーの起動
```bash
# Web Testerを開発モードで起動
npm run dev:tester
```

### 1.4 ブラウザでアクセス
1. **ブラウザを開く**
2. **URLを入力**: `http://localhost:5173`
3. **ページが表示されることを確認**

---

## 🎮 ステップ 2: 基本機能テスト

### 2.1 モデル読み込みテスト
1. **画面上部のドロップダウン**をクリック
2. **「linear」**を選択
3. **「モデルを読み込む」**ボタンをクリック
4. **期待結果**: 
   - ステータスバーに「モデルを読み込みました」と表示
   - 右側にノードグラフが表示
   - 中央に「セッションを開始」ボタンが有効化

### 2.2 セッション開始テスト
1. **「セッションを開始」**ボタンをクリック
2. **期待結果**:
   - ステータスバーに「セッションを開始しました」と表示
   - 中央にノードテキストが表示（例: "ここはスタート地点です"）
   - 下に選択肢ボタンが表示（例: "進む"）

### 2.3 選択肢実行テスト
1. **選択肢ボタン**（例: "進む"）をクリック
2. **期待結果**:
   - 画面が更新され、次のノードのテキストが表示
   - 状態情報が更新（ノードID、時間など）
   - 物語ログが更新

### 2.4 状態確認テスト
1. **画面右側の「状態」パネル**を確認
2. **期待結果**:
   - 現在のノードIDが表示
   - フラグとリソースの状態が表示
   - 時間がカウントアップされている

---

## 🤖 ステップ 3: AI 機能テスト（モックプロバイダー）

### 3.1 AI タブへの移動
1. **上部のタブ**から「AI」をクリック
2. **期待結果**: AI 設定フォームが表示

### 3.2 モックプロバイダー設定
1. **「Provider」ドロップダウン**で「mock」を選択
2. **「設定を保存」**ボタンをクリック
3. **期待結果**:
   - 「mockプロバイダーが初期化されました」と表示

### 3.3 次のノード生成テスト
1. **基本機能テストのモデル**が読み込まれていることを確認
2. **「次のノードを生成」**ボタンをクリック
3. **期待結果**:
   - すぐに「⏳ 生成中...」と表示
   - すぐに「✅ 生成されたテキスト (0.00秒):」に変わり、ランダムなテキストが表示

### 3.4 言い換え機能テスト
1. **「現在のテキストを言い換え」**ボタンをクリック
2. **期待結果**:
   - 「⏳ 言い換え中...」と表示
   - すぐに「✅ 言い換え結果 (0.00秒):」に変わり、3つのバリエーションが表示

---

## 🔑 ステップ 4: AI 機能テスト（OpenAI プロバイダー）

### ⚠️ 前提条件
- OpenAI API キーが必要です
- 取得方法: https://platform.openai.com/api-keys

### 4.1 OpenAI プロバイダー設定
1. **「Provider」**で「openai」を選択
2. **API キーを入力**（例: `sk-...`）
3. **モデル名を確認**（デフォルト: gpt-3.5-turbo）
4. **「設定を保存」**をクリック
5. **期待結果**:
   - 「openaiプロバイダーが初期化されました」と表示

### 4.2 OpenAI でのノード生成
1. **「次のノードを生成」**をクリック
2. **期待結果**:
   - 「⏳ 生成中...」と表示（数秒待つ）
   - 「✅ 生成されたテキスト (2.34秒):」に変わり、自然な日本語の物語テキストが生成

### 4.3 OpenAI での言い換え
1. **「現在のテキストを言い換え」**をクリック
2. **期待結果**:
   - 「⏳ 言い換え中...」と表示
   - 「✅ 言い換え結果 (1.87秒):」に変わり、3つの異なる言い換えバリエーションが表示

---

## 🚨 ステップ 5: エラーハンドリングテスト

### 5.1 API キー未設定テスト
1. **Provider を openai** に変更
2. **API キーを空欄**にする
3. **「設定を保存」**をクリック
4. **「次のノードを生成」**をクリック
5. **期待結果**:
   - 「❌ モデルを読み込んでから実行してください」と表示

### 5.2 無効な API キーテスト
1. **API キーに無効な値を入力**（例: `invalid-key`）
2. **「設定を保存」**をクリック
3. **「次のノードを生成」**をクリック
4. **期待結果**:
   - 「❌ APIエラー: ...」と表示され、具体的なエラーメッセージが表示

### 5.3 ネットワークエラーテスト
1. **ブラウザの開発者ツール**を開く（F12）
2. **Network タブ**で「Offline」に設定
3. **「次のノードを生成」**をクリック
4. **期待結果**:
   - ネットワークエラーの適切なメッセージが表示

---

## 🎨 ステップ 6: GUI エディタテスト

### 6.1 エディタモード開始
1. **「モデルを編集」**ボタンをクリック
2. **期待結果**: 編集モードに切り替わり、ノードリストが表示

### 6.2 ノード編集
1. **ノードをクリック**して選択
2. **テキストフィールド**を編集
3. **「更新」**ボタンをクリック
4. **期待結果**: ノードの内容が更新

### 6.3 ノード追加
1. **「ノードを追加」**ボタンをクリック
2. **期待結果**: 新しいノードが追加され、編集可能

### 6.4 編集保存
1. **「GUI編集を保存」**ボタンをクリック
2. **期待結果**:
   - 「GUI編集を保存しました」と表示
   - セッションが再開され、編集内容が反映

---

## 📊 ステップ 7: CSV エクスポートテスト

### 7.1 エクスポート実行
1. **モデルを読み込んだ状態**で
2. **「CSVエクスポート」**ボタンをクリック
3. **期待結果**: CSV ファイルがダウンロード

### 7.2 CSV 内容確認
1. **ダウンロードした CSV** を開く
2. **期待結果**:
   - ヘッダー行: `node_id,node_text,node_type,node_tags,node_assets,choice_id,choice_text,choice_target,choice_conditions,choice_effects,choice_outcome_type,choice_outcome_value,choice_metadata,choice_variables,initial_flags,initial_resources,global_metadata`
   - 各ノードの情報が正しくエクスポートされている

---

## 🔍 ステップ 8: ログ確認

### 8.1 ブラウザコンソール確認
1. **開発者ツール**を開く（F12）
2. **Console タブ**を確認
3. **期待結果**:
   - AI 機能使用時のログエントリ
   - エラー発生時の詳細情報

### 8.2 sessionStorage ログ確認
1. **開発者ツール**の Console で実行:
   ```javascript
   JSON.parse(sessionStorage.getItem('narrativeGenLogs'))
   ```
2. **期待結果**: 構造化されたログエントリが表示

---

## ✅ テスト完了チェックリスト

- [ ] モデル読み込みとセッション開始
- [ ] 選択肢実行と状態更新
- [ ] モック AI 機能（ノード生成・言い換え）
- [ ] OpenAI 機能（API キー設定済みの場合）
- [ ] エラーハンドリング（API キー未設定、無効キー）
- [ ] GUI エディタ（ノード編集・追加・保存）
- [ ] CSV エクスポート
- [ ] ログ記録の確認

## 🐛 問題発生時の対応

### 症状: 「初期化中...」から進まない
1. ブラウザの開発者ツールを開く
2. Console タブでエラーメッセージを確認
3. ネットワークタブでリソース読み込み失敗を確認

### 症状: AI 機能が動作しない
1. AI タブでプロバイダー設定を確認
2. OpenAI の場合は API キーが正しいか確認
3. ブラウザのネットワークタブで API リクエストを確認

### 症状: ビルドエラー
```bash
npm run build:all
```
で問題を再現し、エラーメッセージを確認

---

## 🎉 テスト完了！

全てのテストが成功したら、以下のコマンドで変更をコミット：

```bash
git add .
git commit -m "Test all features successfully"
git push origin master
```

**テスト完了時間**: 約15-30分
**必要なツール**: ブラウザ、テキストエディタ（オプション）
**前提知識**: 基本的な Web 操作
